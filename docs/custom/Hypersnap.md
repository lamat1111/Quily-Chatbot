---
title: Hypersnap
source: GitHub Repository
date: 2026-02-09
type: technical_reference
topics: [snapchain, farcaster, hyper-mode, rust, data-availability]
---

# Hypersnap

Hypersnap is the open-source, canonical Rust implementation of Snapchain -- a decentralized, peer-to-peer data storage layer for the Farcaster social protocol. It is a modified Farcaster Snapchain node with **Hyper Mode** for full historical data retention and enhanced data availability.

## Overview

Snapchain is a high-performance blockchain-like network that stores user-generated data (casts, reactions, links, verifications) for the Farcaster protocol without requiring traditional blockchain overhead. Hypersnap extends Snapchain with a dual-pipeline architecture that retains all historical data indefinitely while remaining backward compatible with standard Snapchain peers.

### Key Characteristics

- **High Throughput**: Targets 10,000+ transactions per second
- **Affordable Infrastructure**: Runnable for under $1,000/month on modest hardware (16GB RAM, 4 CPU cores, 1.5TB storage)
- **Sharded Network**: Multiple shards for distributed processing (shard 0 is special for transaction/event production)
- **BFT Consensus**: Uses Malachite BFT consensus from Informal Systems for deterministic block ordering
- **Written in Rust**: For performance and memory safety

## Hyper Mode

Hyper Mode is the defining feature of Hypersnap -- an execution context that maintains all historical data without pruning limits. It operates alongside the canonical Snapchain pipeline.

### Features

- **Full historical data retention without pruning**: The hyper pipeline keeps all messages and blocks indefinitely, unlike canonical Snapchain which prunes older data
- **Dual pipeline execution (legacy + hyper)**: Both pipelines run simultaneously -- legacy follows canonical pruning rules while hyper retains everything
- **HyperEnvelope exchange between hyper-capable peers**: Enhanced block data sent only between nodes that advertise hyper capability
- **Backward compatible with legacy Snapchain peers**: Nodes without hyper mode can still communicate normally via the legacy pipeline
- **Diff and audit tooling for state comparison**: Built-in CLI tools to compare canonical vs hyper state and verify consistency

### How Dual Pipeline Works

When a Hypersnap node processes blocks:

1. The **legacy pipeline** follows standard Snapchain pruning rules, keeping only recent data within the retention window
2. The **hyper pipeline** stores the same data without any pruning, maintaining a complete historical record
3. Both pipelines share the same consensus layer but use **separate storage namespaces** in RocksDB
4. Peers advertise their capabilities via a `CAPABILITY_HYPER` flag during gossip handshakes
5. Hyper-capable peers exchange `HyperEnvelope` messages containing enhanced metadata

### Hyper Data Structures

- **`StateContext`**: Enum with `Legacy` and `Hyper` variants, used to tag all storage operations with the correct pipeline context
- **`HyperBlockMetadata`**: Tracks `canonical_block_id`, `parent_hash`, `hyper_state_root`, `rules_version`, and `retained_message_count`
- **`HyperEnvelope`**: Contains metadata plus hyper-specific payload, exchanged between hyper-capable peers
- **`HyperDiffReport`**: Generated by diff tooling to detect and report divergences between legacy and hyper state

## Architecture

### Core Modules

- **api/**: REST/HTTP API handlers for search, feeds, conversations, social graph, and indexing
- **consensus/**: Malachite BFT consensus integration with shard-aware validation
- **network/**: libp2p-based gossip protocol, gRPC server (HubService, AdminService, ReplicationService), HTTP server, and peer replication management
- **storage/**: RocksDB-backed key-value store, Merkle trie for state verification, snapshot generation and downloading, column family management
- **mempool/**: Transaction routing and batching
- **hyper/**: Hyper mode context and dual pipeline implementation
- **connectors/**: OnchainEvents (Ethereum L1 integration) and Fnames (resolver integration)
- **jobs/**: Background tasks including pruning, snapshots, and cron jobs
- **bootstrap/**: Node startup and initialization

### Storage Architecture

- **RocksDB** with multi-threaded column families provides persistent storage
- **Namespaced key ranges** separate legacy and hyper data within the same database
- **Merkle Trie** enables efficient state proofs and incremental synchronization
- Pruning is configurable: the hyper pipeline disables it entirely while the legacy pipeline follows standard retention rules

### Networking

- **libp2p**: Peer discovery via mDNS, TCP/QUIC transports, Yamux multiplexing
- **Gossip Protocol**: Custom protocol with capability negotiation including the `CAPABILITY_HYPER` handshake
- **Default Ports**: 3381 (HTTP), 3382 (Gossip), 3383 (RPC)
- **Replication**: Efficient state synchronization via Merkle trie and snapshot downloads

### L1 Integration

- Monitors Ethereum (Base/Optimism) for protocol events
- Processes `OnchainEvent` data into the Snapchain L2 layer
- Verifies signatures using alloy providers

## CLI Tools

### Hyper-Specific Commands

| Command | Description |
|---------|-------------|
| `hyper diff --block <n>` | Compare canonical vs hyper state at a specific block height |
| `hyper audit --latest <m>` | Verify hyper envelope consistency for the latest m blocks |
| `hyper metrics --tail` | Stream real-time hyper pipeline metrics |

The diff tool generates a `HyperDiffReport` that identifies divergences between the canonical and hyper pipelines, useful for validating that the hyper pipeline correctly retains all data.

### General Node Commands

| Command | Description |
|---------|-------------|
| `snapchain` | Run the main Snapchain node |
| `generate_keys` | Create Ed25519 keypairs for node identity |
| `dump_wal` | Inspect consensus write-ahead logs |
| `follow_blocks` | Stream blocks from a running node |
| `submit_message` | Submit messages to the network |
| `setup_local_testnet` | Bootstrap a local development network |
| `perftest` | Run performance testing suite |

### Running a Node

```bash
# One-command bootstrap
curl -sSL https://raw.githubusercontent.com/farcasterxyz/snapchain/refs/heads/main/scripts/snapchain-bootstrap.sh | bash

# Docker Compose management
./snapchain.sh upgrade   # Upgrade to latest version
./snapchain.sh start     # Start node
./snapchain.sh stop      # Stop node
./snapchain.sh logs      # View logs
```

## Hyper Mode Metrics

Hyper Mode exposes dedicated metrics for monitoring the dual pipeline:

- **`hyper_pipeline_lag`**: Processing delay between canonical and hyper pipelines
- **`hyper_storage_bytes`**: Disk usage of the unbounded hyper store
- **`hyper_diff_failures`**: Count of validation errors detected between pipelines

These metrics can be streamed in real-time using `hyper metrics --tail` and are also available via StatsD integration for dashboard monitoring.

## Protocol Buffers

Hypersnap uses Protocol Buffers for all inter-node communication:

- **`hyper.proto`**: Defines HyperEnvelope and hyper-specific message types
- **`blocks.proto`**: Block structure definitions
- **`gossip.proto`**: Peer gossip messages with capability flags
- **`message.proto`**: User messages (casts, reactions, links, verifications)
- **`replication.proto`**: State replication protocol
- **`sync_trie.proto`**: Merkle trie synchronization

## Web Console (Coming Soon)

A web-based console is under development with planned features:

- **Node status and health monitoring**: Real-time view of node health and connectivity
- **Hyper vs legacy state comparison UI**: Visual interface for the diff tooling
- **Block explorer with hyper metadata**: Browse blocks with full hyper pipeline data
- **Storage usage and metrics dashboard**: Monitor disk usage and pipeline performance

## Key Dependencies

| Library | Purpose |
|---------|---------|
| tokio | Async runtime |
| tonic / prost | gRPC and protobuf |
| libp2p | P2P networking |
| rocksdb | Persistent storage |
| malachite-bft | BFT consensus (Informal Systems) |
| alloy | Ethereum integration |
| tantivy | Full-text search indexing |
| clap | CLI argument parsing |

## Source

- **Repository**: [QuilibriumNetwork/hypersnap](https://github.com/QuilibriumNetwork/hypersnap)
- **Language**: Rust
- **License**: Open source
- **Latest Version**: v0.11.2 (January 2026)
