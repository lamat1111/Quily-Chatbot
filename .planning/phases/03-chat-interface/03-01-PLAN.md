---
phase: 03-chat-interface
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - app/globals.css
  - postcss.config.mjs
  - app/layout.tsx
  - src/hooks/useLocalStorage.ts
  - src/hooks/useScrollAnchor.ts
  - src/stores/conversationStore.ts
  - src/lib/openrouter.ts
autonomous: true

must_haves:
  truths:
    - "Tailwind CSS 4.x is configured and functional"
    - "Zustand store persists conversations to localStorage"
    - "useLocalStorage hook handles SSR hydration safely"
  artifacts:
    - path: "app/globals.css"
      provides: "Tailwind CSS imports"
      contains: "@import"
    - path: "postcss.config.mjs"
      provides: "Tailwind PostCSS plugin"
      contains: "@tailwindcss/postcss"
    - path: "src/hooks/useLocalStorage.ts"
      provides: "localStorage hook with hydration safety"
      exports: ["useLocalStorage"]
    - path: "src/stores/conversationStore.ts"
      provides: "Conversation history store"
      exports: ["useConversationStore"]
  key_links:
    - from: "src/stores/conversationStore.ts"
      to: "localStorage"
      via: "zustand persist middleware"
      pattern: "persist.*localStorage"
---

<objective>
Set up Phase 3 foundation: Tailwind CSS 4.x configuration, shared hooks, Zustand store, and install frontend dependencies.

Purpose: All chat UI components depend on these shared utilities. Getting foundation right prevents cascading issues.
Output: Working Tailwind setup, reusable hooks (useLocalStorage, useScrollAnchor), conversation store with persistence, OpenRouter helper utilities.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-chat-interface/03-RESEARCH.md

# Existing files to understand
@app/api/chat/route.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and configure Tailwind CSS 4.x</name>
  <files>
    package.json
    app/globals.css
    postcss.config.mjs
    app/layout.tsx
  </files>
  <action>
Install chat UI dependencies:
```bash
npm install @ai-sdk/react zustand react-markdown remark-gfm react-syntax-highlighter react-intersection-observer clsx
npm install -D tailwindcss @tailwindcss/postcss @types/react-syntax-highlighter
```

Create `postcss.config.mjs`:
```javascript
export default {
  plugins: {
    '@tailwindcss/postcss': {},
  },
};
```

Create `app/globals.css` with Tailwind CSS 4.x imports:
```css
@import "tailwindcss";
```

Create `app/layout.tsx` (root layout with globals import):
- Import globals.css
- Basic HTML structure with metadata
- Children rendering in body
- Use Inter font from next/font/google for clean typography
  </action>
  <verify>
Run `npm run dev` - should start without Tailwind errors.
Check that `app/globals.css` contains `@import "tailwindcss"`.
  </verify>
  <done>
Next.js dev server starts cleanly with Tailwind 4.x configured.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shared hooks and utilities</name>
  <files>
    src/hooks/useLocalStorage.ts
    src/hooks/useScrollAnchor.ts
    src/lib/openrouter.ts
  </files>
  <action>
Create `src/hooks/useLocalStorage.ts`:
- Generic hook: `useLocalStorage<T>(key: string, initialValue: T)`
- Returns `[value, setValue]` tuple
- Handle SSR hydration safely (useState with initialValue, useEffect to hydrate)
- Include `isHydrated` state to prevent hydration mismatch
- Wrap localStorage access in try/catch for safety

Create `src/hooks/useScrollAnchor.ts`:
- Use react-intersection-observer to detect if user is at bottom
- Return: `{ scrollRef, anchorRef, isAtBottom, scrollToBottom }`
- scrollRef goes on scrollable container
- anchorRef goes on invisible div at bottom
- scrollToBottom uses smooth scroll behavior

Create `src/lib/openrouter.ts`:
- `validateApiKey(apiKey: string): Promise<boolean>` - calls OpenRouter /models endpoint
- `RECOMMENDED_MODELS` array with id and name for dropdown:
  - meta-llama/llama-3.1-70b-instruct (Llama 3.1 70B)
  - mistralai/mixtral-8x7b-instruct (Mixtral 8x7B)
  - qwen/qwen-2.5-72b-instruct (Qwen 2.5 72B)
  - anthropic/claude-3.5-sonnet (Claude 3.5 Sonnet)
  - google/gemini-pro-1.5 (Gemini Pro 1.5)
  </action>
  <verify>
TypeScript compiles: `npm run typecheck` passes.
Files exist at expected paths.
  </verify>
  <done>
Hooks are typed correctly and export expected functions.
OpenRouter helper exports validateApiKey and RECOMMENDED_MODELS.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Zustand conversation store</name>
  <files>
    src/stores/conversationStore.ts
  </files>
  <action>
Create `src/stores/conversationStore.ts`:

Define types:
```typescript
interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
}

interface Conversation {
  id: string;
  title: string;
  messages: Message[];
  createdAt: number;
  updatedAt: number;
}

interface ConversationStore {
  conversations: Conversation[];
  activeId: string | null;
  _hasHydrated: boolean;

  // Actions
  addConversation: (title?: string) => string; // returns new id
  setActive: (id: string | null) => void;
  updateMessages: (id: string, messages: Message[]) => void;
  updateTitle: (id: string, title: string) => void;
  deleteConversation: (id: string) => void;
  getActiveConversation: () => Conversation | null;
}
```

Implementation:
- Use `create` from zustand
- Wrap with `persist` middleware from `zustand/middleware`
- Storage name: 'chat-conversations'
- Use `createJSONStorage(() => localStorage)`
- Set `_hasHydrated: true` in `onRehydrateStorage` callback
- `addConversation` generates UUID with crypto.randomUUID()
- Auto-generate title from first 50 chars of first message if not provided
- Limit to 50 conversations max (delete oldest when exceeded)
  </action>
  <verify>
TypeScript compiles: `npm run typecheck` passes.
Export `useConversationStore` hook.
  </verify>
  <done>
Store exports useConversationStore with all actions.
_hasHydrated flag available for hydration safety.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. `npm run typecheck` passes
3. All files exist:
   - app/globals.css
   - postcss.config.mjs
   - app/layout.tsx
   - src/hooks/useLocalStorage.ts
   - src/hooks/useScrollAnchor.ts
   - src/stores/conversationStore.ts
   - src/lib/openrouter.ts
</verification>

<success_criteria>
- Tailwind CSS 4.x configured and working
- useLocalStorage hook handles SSR safely
- useScrollAnchor hook provides scroll management
- Zustand store persists to localStorage
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-chat-interface/03-01-SUMMARY.md`
</output>
