---
phase: 03-chat-interface
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/sidebar/Sidebar.tsx
  - src/components/sidebar/ApiKeyConfig.tsx
  - src/components/sidebar/ModelSelector.tsx
  - src/components/sidebar/ConversationList.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter and validate their OpenRouter API key"
    - "API key persists in localStorage across sessions"
    - "User can select from available LLM models"
    - "User can see and switch between conversations"
  artifacts:
    - path: "src/components/sidebar/ApiKeyConfig.tsx"
      provides: "API key input with validation"
      exports: ["ApiKeyConfig"]
    - path: "src/components/sidebar/ModelSelector.tsx"
      provides: "Model dropdown selector"
      exports: ["ModelSelector"]
    - path: "src/components/sidebar/ConversationList.tsx"
      provides: "Conversation history list"
      exports: ["ConversationList"]
    - path: "src/components/sidebar/Sidebar.tsx"
      provides: "Sidebar container"
      exports: ["Sidebar"]
  key_links:
    - from: "src/components/sidebar/ApiKeyConfig.tsx"
      to: "src/hooks/useLocalStorage.ts"
      via: "hook import"
      pattern: "useLocalStorage.*openrouter-api-key"
    - from: "src/components/sidebar/ApiKeyConfig.tsx"
      to: "src/lib/openrouter.ts"
      via: "validation call"
      pattern: "validateApiKey"
    - from: "src/components/sidebar/ConversationList.tsx"
      to: "src/stores/conversationStore.ts"
      via: "store hook"
      pattern: "useConversationStore"
---

<objective>
Build sidebar components: API key configuration, model selector, and conversation history list.

Purpose: Users need to configure their API key and model before chatting. Conversation list enables history browsing.
Output: Complete sidebar UI with API key validation, model selection, and conversation switching.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-chat-interface/03-CONTEXT.md
@.planning/phases/03-chat-interface/03-RESEARCH.md

# Dependencies from Plan 01 (will exist when this runs)
@src/hooks/useLocalStorage.ts
@src/stores/conversationStore.ts
@src/lib/openrouter.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API Key and Model selector components</name>
  <files>
    src/components/sidebar/ApiKeyConfig.tsx
    src/components/sidebar/ModelSelector.tsx
  </files>
  <action>
Create `src/components/sidebar/ApiKeyConfig.tsx`:
- 'use client' directive at top
- Props: none (uses hooks internally)
- Use `useLocalStorage<string>('openrouter-api-key', '')` for key storage
- State: `isValidating`, `isValid` (boolean | null)
- Display:
  - Label: "OpenRouter API Key"
  - Password input (always masked per CONTEXT.md - no reveal option)
  - Show last 6 chars as hint when key exists: "Key: ••••••abc123"
  - Validate on blur if key > 10 chars (debounce not needed, just blur)
  - Show loading spinner during validation
  - Show green checkmark if valid, red X if invalid
  - Inline error message below field for invalid keys
- Tailwind styling: gray border, focus:ring-blue-500, rounded-lg

Create `src/components/sidebar/ModelSelector.tsx`:
- 'use client' directive
- Props: `value: string`, `onChange: (model: string) => void`
- Import RECOMMENDED_MODELS from '@/src/lib/openrouter'
- Simple select dropdown with Tailwind styling
- Label: "Model"
- Each option shows model.name (friendly name)
- Value is model.id (OpenRouter model ID)
  </action>
  <verify>
TypeScript compiles: `npm run typecheck` passes.
Components export correctly.
  </verify>
  <done>
ApiKeyConfig validates keys and persists to localStorage.
ModelSelector renders dropdown with recommended models.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ConversationList and Sidebar container</name>
  <files>
    src/components/sidebar/ConversationList.tsx
    src/components/sidebar/Sidebar.tsx
  </files>
  <action>
Create `src/components/sidebar/ConversationList.tsx`:
- 'use client' directive
- Use `useConversationStore` for conversations and actions
- Check `_hasHydrated` before rendering (show skeleton/loading if false)
- Display conversations sorted by updatedAt (newest first)
- Each conversation shows:
  - Title (truncated to 30 chars with ellipsis)
  - Relative time (use simple "today", "yesterday", or date)
- Active conversation highlighted with bg-blue-50
- Click to set active (`setActive(id)`)
- Delete button (X icon) on hover, calls `deleteConversation(id)`
- "New Chat" button at top calls `addConversation()` and sets active
- Empty state: "No conversations yet"

Create `src/components/sidebar/Sidebar.tsx`:
- 'use client' directive
- Props: none (self-contained)
- State: `sidebarOpen` for mobile toggle (default true on desktop)
- Layout per CONTEXT.md:
  - API key config at top
  - Model selector below API key
  - Divider
  - ConversationList fills remaining space (flex-1 overflow-y-auto)
- Tailwind responsive:
  - Desktop (lg+): w-72, always visible
  - Mobile: full width when open, hidden when closed
  - Transition animation on open/close
- Mobile toggle button (hamburger icon) at bottom-left corner, fixed position
- Border-r border-gray-200 to separate from main content
  </action>
  <verify>
TypeScript compiles: `npm run typecheck` passes.
Sidebar exports and renders child components.
  </verify>
  <done>
ConversationList shows history with new/switch/delete functionality.
Sidebar contains all configuration and is responsive.
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. All files exist:
   - src/components/sidebar/ApiKeyConfig.tsx
   - src/components/sidebar/ModelSelector.tsx
   - src/components/sidebar/ConversationList.tsx
   - src/components/sidebar/Sidebar.tsx
3. Each component has 'use client' directive
4. ApiKeyConfig uses useLocalStorage hook
5. ConversationList uses useConversationStore
</verification>

<success_criteria>
- API key input validates via OpenRouter API (KEY-01, KEY-03)
- API key persists in localStorage (KEY-02)
- Key always masked, no reveal option (CONTEXT.md decision)
- Model dropdown shows recommended models (KEY-04)
- Conversation list shows history with switch/delete
- Sidebar is responsive (mobile collapse)
</success_criteria>

<output>
After completion, create `.planning/phases/03-chat-interface/03-02-SUMMARY.md`
</output>
