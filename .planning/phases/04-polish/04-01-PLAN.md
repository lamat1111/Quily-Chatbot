---
phase: 04-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - app/globals.css
  - app/layout.tsx
  - src/components/providers/ThemeProvider.tsx
  - src/components/ui/ThemeToggle.tsx
  - src/components/sidebar/Sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle between light and dark mode"
    - "Theme choice persists across page refresh"
    - "Dark mode is the default theme"
    - "No flash of wrong theme on page load"
  artifacts:
    - path: "src/components/providers/ThemeProvider.tsx"
      provides: "next-themes wrapper with dark default"
      exports: ["ThemeProvider"]
    - path: "src/components/ui/ThemeToggle.tsx"
      provides: "Theme switch button with sun/moon icons"
      exports: ["ThemeToggle"]
    - path: "app/globals.css"
      provides: "Tailwind dark mode variant"
      contains: "@custom-variant dark"
  key_links:
    - from: "app/layout.tsx"
      to: "ThemeProvider"
      via: "wrap children"
      pattern: "ThemeProvider"
    - from: "src/components/sidebar/Sidebar.tsx"
      to: "ThemeToggle"
      via: "render in header"
      pattern: "ThemeToggle"
---

<objective>
Install theme infrastructure and implement light/dark mode toggle.

Purpose: Satisfies RENDER-05 requirement and establishes foundation for theme-aware components. This is foundational work that other plans depend on for consistent theming.

Output: Working theme toggle in sidebar, theme persistence via localStorage, dark mode as default.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-polish/04-RESEARCH.md

# Existing files to modify
@app/layout.tsx
@app/globals.css
@src/components/sidebar/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and update globals.css</name>
  <files>package.json, app/globals.css</files>
  <action>
1. Install required packages:
   ```bash
   npm install @radix-ui/react-dialog next-themes
   ```

2. Update `app/globals.css` to add Tailwind CSS 4.x dark mode variant:
   ```css
   @import "tailwindcss";
   @custom-variant dark (&:where(.dark, .dark *));
   ```

Note: The @custom-variant syntax is Tailwind CSS 4.x specific. This enables `dark:` classes to work with next-themes class-based theme switching.
  </action>
  <verify>
- `npm ls @radix-ui/react-dialog next-themes` shows both installed
- `cat app/globals.css` shows @custom-variant line
  </verify>
  <done>Dependencies installed and dark mode CSS variant configured</done>
</task>

<task type="auto">
  <name>Task 2: Create ThemeProvider and ThemeToggle components</name>
  <files>src/components/providers/ThemeProvider.tsx, src/components/ui/ThemeToggle.tsx</files>
  <action>
1. Create `src/components/providers/ThemeProvider.tsx`:
   - 'use client' directive (required for next-themes)
   - Wrap NextThemesProvider with settings:
     - attribute="class" (for Tailwind dark: classes)
     - defaultTheme="dark" (dark is default per requirements)
     - enableSystem (respect OS preference as option)
     - disableTransitionOnChange (snappy theme switch, no jarring transitions)

2. Create `src/components/ui/ThemeToggle.tsx`:
   - 'use client' directive
   - Use `useTheme` hook from next-themes
   - Implement `mounted` state pattern to avoid hydration mismatch:
     - useState(false) for mounted
     - useEffect to set mounted = true
     - Return placeholder div while not mounted
   - Toggle button with sun/moon SVG icons:
     - Sun icon when dark (click to switch to light)
     - Moon icon when light (click to switch to dark)
   - Use resolvedTheme to handle system theme correctly
   - Button styling: p-2 rounded-lg with hover states, theme-aware colors
   - aria-label for accessibility: "Switch to {light|dark} mode"

SVG icons (inline, no external deps):
- Sun: circle with rays (for light mode option)
- Moon: crescent shape (for dark mode option)
  </action>
  <verify>
- Files exist at expected paths
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>ThemeProvider and ThemeToggle components created with hydration safety</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ThemeProvider and ThemeToggle</name>
  <files>app/layout.tsx, src/components/sidebar/Sidebar.tsx</files>
  <action>
1. Update `app/layout.tsx`:
   - Import ThemeProvider from '@/src/components/providers/ThemeProvider'
   - Wrap {children} with ThemeProvider
   - Keep suppressHydrationWarning on html element (required by next-themes)
   - Structure: html > body > ThemeProvider > {children}

2. Update `src/components/sidebar/Sidebar.tsx`:
   - Import ThemeToggle from '@/src/components/ui/ThemeToggle'
   - Add ThemeToggle to sidebar header area (near top, accessible location)
   - Position in header section, after title or in a flex row with title

Note: Existing sidebar has dark background. After this change, background colors should use theme-aware classes:
- Current: bg-gray-900 -> Change to: bg-white dark:bg-gray-900
- Current: text-gray-100 -> Change to: text-gray-900 dark:text-gray-100
- Apply similar pattern to border colors, hover states

Update all hardcoded dark colors in Sidebar.tsx to be theme-aware.
  </action>
  <verify>
- `npm run dev` starts without errors
- Visit http://localhost:3000
- Theme toggle button visible in sidebar
- Click toggle: page switches between light/dark themes
- Refresh page: theme persists (localStorage)
- New browser/incognito: defaults to dark theme
  </verify>
  <done>Theme system fully integrated with working toggle in sidebar</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run build` succeeds (no TypeScript/build errors)
2. Theme toggle is accessible in sidebar header
3. Clicking toggle switches all colors (background, text, borders)
4. Theme persists across page refresh
5. Dark mode is default for new users
6. No hydration mismatch errors in console
</verification>

<success_criteria>
- RENDER-05 satisfied: User can toggle between light and dark mode
- Dark mode is default
- Theme persists via localStorage
- No visible flash of wrong theme on page load
- Sidebar shows ThemeToggle button
- All sidebar colors are theme-aware
</success_criteria>

<output>
After completion, create `.planning/phases/04-polish/04-01-SUMMARY.md`
</output>
