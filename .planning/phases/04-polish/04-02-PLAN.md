---
phase: 04-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useCopyToClipboard.ts
  - src/components/ui/CopyButton.tsx
  - src/components/ui/Skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "Copy functionality shows visual feedback (checkmark) for 2 seconds"
    - "Copy works with Clipboard API"
    - "Skeleton components animate with pulse effect"
  artifacts:
    - path: "src/hooks/useCopyToClipboard.ts"
      provides: "Clipboard API hook with state tracking"
      exports: ["useCopyToClipboard"]
    - path: "src/components/ui/CopyButton.tsx"
      provides: "Reusable copy button with feedback animation"
      exports: ["CopyButton"]
    - path: "src/components/ui/Skeleton.tsx"
      provides: "Loading skeleton primitives"
      exports: ["Skeleton", "MessageListSkeleton"]
  key_links:
    - from: "CopyButton"
      to: "useCopyToClipboard"
      via: "hook consumption"
      pattern: "useCopyToClipboard"
---

<objective>
Create reusable clipboard hook and UI components for copy functionality and loading states.

Purpose: Provides building blocks for RENDER-04 (code copy), POLISH-01 (message copy), and POLISH-03 (skeletons). These are standalone utilities that other plans will consume.

Output: useCopyToClipboard hook, CopyButton component with visual feedback, Skeleton components.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-polish/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useCopyToClipboard hook</name>
  <files>src/hooks/useCopyToClipboard.ts</files>
  <action>
Create `src/hooks/useCopyToClipboard.ts`:

```typescript
'use client';

import { useState, useCallback } from 'react';

interface UseCopyToClipboardReturn {
  copiedText: string | null;
  copy: (text: string) => Promise<boolean>;
  reset: () => void;
}

/**
 * Hook for copying text to clipboard with state tracking.
 *
 * Returns:
 * - copiedText: The last successfully copied text (null if none)
 * - copy: Async function to copy text, returns success boolean
 * - reset: Function to clear copied state
 */
export function useCopyToClipboard(): UseCopyToClipboardReturn {
  const [copiedText, setCopiedText] = useState<string | null>(null);

  const copy = useCallback(async (text: string): Promise<boolean> => {
    // Check clipboard API availability
    if (!navigator?.clipboard) {
      console.warn('Clipboard API not available');
      return false;
    }

    try {
      await navigator.clipboard.writeText(text);
      setCopiedText(text);
      return true;
    } catch (error) {
      console.warn('Failed to copy to clipboard:', error);
      setCopiedText(null);
      return false;
    }
  }, []);

  const reset = useCallback(() => {
    setCopiedText(null);
  }, []);

  return { copiedText, copy, reset };
}
```

Key features:
- Uses native Clipboard API (NOT deprecated execCommand)
- Returns success boolean for error handling
- Provides reset function for clearing state
- Handles API unavailability gracefully
  </action>
  <verify>
- File exists at src/hooks/useCopyToClipboard.ts
- `npx tsc --noEmit` passes
  </verify>
  <done>useCopyToClipboard hook created with clipboard API support</done>
</task>

<task type="auto">
  <name>Task 2: Create CopyButton component</name>
  <files>src/components/ui/CopyButton.tsx</files>
  <action>
Create `src/components/ui/CopyButton.tsx`:

```typescript
'use client';

import { useState, useCallback } from 'react';

interface CopyButtonProps {
  text: string;
  className?: string;
  size?: 'sm' | 'md';
  variant?: 'default' | 'ghost';
}

/**
 * Copy button with visual feedback.
 * Shows checkmark for 2 seconds after successful copy.
 *
 * Props:
 * - text: Content to copy
 * - className: Additional CSS classes
 * - size: Button size (sm = 16px icons, md = 20px icons)
 * - variant: default (with background) or ghost (transparent until hover)
 */
export function CopyButton({
  text,
  className = '',
  size = 'md',
  variant = 'default'
}: CopyButtonProps) {
  const [copied, setCopied] = useState(false);

  const handleCopy = useCallback(async () => {
    if (!navigator?.clipboard) {
      console.warn('Clipboard not available');
      return;
    }

    try {
      await navigator.clipboard.writeText(text);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch (error) {
      console.warn('Copy failed:', error);
    }
  }, [text]);

  const iconSize = size === 'sm' ? 'w-4 h-4' : 'w-5 h-5';

  const baseStyles = 'p-1.5 rounded transition-all focus:outline-none focus:ring-2 focus:ring-blue-500';
  const variantStyles = variant === 'ghost'
    ? 'opacity-0 group-hover:opacity-100 hover:bg-gray-700 dark:hover:bg-gray-600'
    : 'bg-gray-700 dark:bg-gray-600 hover:bg-gray-600 dark:hover:bg-gray-500';

  return (
    <button
      onClick={handleCopy}
      className={`${baseStyles} ${variantStyles} ${className}`}
      aria-label={copied ? 'Copied!' : 'Copy to clipboard'}
      title={copied ? 'Copied!' : 'Copy to clipboard'}
    >
      {copied ? (
        // Checkmark icon
        <svg
          className={`${iconSize} text-green-400`}
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M5 13l4 4L19 7"
          />
        </svg>
      ) : (
        // Clipboard icon
        <svg
          className={`${iconSize} text-gray-300 dark:text-gray-400`}
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
          />
        </svg>
      )}
    </button>
  );
}
```

Key features:
- Self-contained (doesn't require hook import for simpler usage)
- 2-second feedback timeout with checkmark
- Two variants: default (visible) and ghost (appears on hover with group class)
- Two sizes for different contexts (code blocks vs message headers)
- Accessible with aria-label and title
- Theme-aware colors with dark: variants
  </action>
  <verify>
- File exists at src/components/ui/CopyButton.tsx
- `npx tsc --noEmit` passes
  </verify>
  <done>CopyButton component created with visual feedback and variants</done>
</task>

<task type="auto">
  <name>Task 3: Create Skeleton components</name>
  <files>src/components/ui/Skeleton.tsx</files>
  <action>
Create `src/components/ui/Skeleton.tsx`:

```typescript
interface SkeletonProps {
  className?: string;
}

/**
 * Base skeleton element with pulse animation.
 * Use className to set dimensions and shape.
 */
export function Skeleton({ className = '' }: SkeletonProps) {
  return (
    <div
      role="status"
      aria-label="Loading"
      className={`animate-pulse bg-gray-300 dark:bg-gray-700 rounded ${className}`}
    >
      <span className="sr-only">Loading...</span>
    </div>
  );
}

/**
 * Skeleton for message list - mimics chat message layout.
 * Shows alternating user/assistant message shapes.
 */
export function MessageListSkeleton() {
  return (
    <div className="space-y-4 p-4">
      {/* User message skeleton */}
      <div className="flex justify-start">
        <Skeleton className="h-12 w-48 rounded-2xl" />
      </div>

      {/* Assistant message skeleton - multiple lines */}
      <div className="flex justify-start">
        <div className="space-y-2 max-w-[80%]">
          <Skeleton className="h-4 w-80" />
          <Skeleton className="h-4 w-64" />
          <Skeleton className="h-4 w-48" />
        </div>
      </div>

      {/* Another user message */}
      <div className="flex justify-start">
        <Skeleton className="h-10 w-36 rounded-2xl" />
      </div>

      {/* Another assistant response */}
      <div className="flex justify-start">
        <div className="space-y-2 max-w-[80%]">
          <Skeleton className="h-4 w-72" />
          <Skeleton className="h-4 w-56" />
        </div>
      </div>
    </div>
  );
}

/**
 * Skeleton for sidebar conversation list.
 */
export function ConversationListSkeleton() {
  return (
    <div className="space-y-2 p-2">
      {[1, 2, 3, 4, 5].map((i) => (
        <div key={i} className="flex items-center gap-3 p-3 rounded-lg">
          <Skeleton className="h-4 w-4 rounded" />
          <Skeleton className="h-4 flex-1" />
        </div>
      ))}
    </div>
  );
}

/**
 * Skeleton for the main chat area during initial load.
 */
export function ChatSkeleton() {
  return (
    <div className="flex-1 flex flex-col bg-white dark:bg-gray-900">
      {/* Message area skeleton */}
      <div className="flex-1 overflow-hidden">
        <MessageListSkeleton />
      </div>

      {/* Input area skeleton */}
      <div className="border-t border-gray-200 dark:border-gray-700 p-4">
        <div className="max-w-3xl mx-auto flex gap-3">
          <Skeleton className="flex-1 h-12 rounded-xl" />
          <Skeleton className="w-20 h-12 rounded-xl" />
        </div>
      </div>
    </div>
  );
}
```

Key features:
- Base Skeleton with configurable dimensions via className
- MessageListSkeleton mimics actual message layout
- ConversationListSkeleton for sidebar
- ChatSkeleton for full chat area
- All use Tailwind animate-pulse
- Theme-aware background colors
- Accessible with role="status" and sr-only text
  </action>
  <verify>
- File exists at src/components/ui/Skeleton.tsx
- `npx tsc --noEmit` passes
  </verify>
  <done>Skeleton components created for various loading states</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npx tsc --noEmit` passes (TypeScript valid)
2. All three files exist in expected locations
3. Components export named exports as specified
</verification>

<success_criteria>
- useCopyToClipboard hook ready for use
- CopyButton component with 2-second visual feedback
- Skeleton components for messages, conversations, and full chat
- All components are theme-aware (dark: variants)
</success_criteria>

<output>
After completion, create `.planning/phases/04-polish/04-02-SUMMARY.md`
</output>
